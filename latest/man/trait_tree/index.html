
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="PhyloNetworks is a Julia package for the manipulation, visualization and inference of phylogenetic networks.">
      
      
      
        <meta name="author" content="Claudia Sol&iacute;s-Lemus">
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.5.5">
    
    
      
        <title>Trait Evolution - PhyloNetworks.jl</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-b1a1975878.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-f78e5cb881.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../assets/Documenter.css">
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="PhyloNetworks.jl" class="md-logo md-header-nav__button">
            <img src="../../snaq_small.png" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Manual
                </span>
              
            
            Trait Evolution
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/crsl4/PhyloNetworks.jl" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../snaq_small.png">
      </i>
    
    PhyloNetworks.jl
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/crsl4/PhyloNetworks.jl" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Manual
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Manual
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../inputdata/" title="Input Data for SNaQ" class="md-nav__link">
      Input Data for SNaQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ticr_howtogetQuartetCFs/" title="TICR pipeline" class="md-nav__link">
      TICR pipeline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../snaq_plot/" title="Network estimation and display" class="md-nav__link">
      Network estimation and display
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fixednetworkoptim/" title="Fixed Network" class="md-nav__link">
      Fixed Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../expectedCFs/" title="Extract Expected CFs" class="md-nav__link">
      Extract Expected CFs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bootstrap/" title="Bootstrap" class="md-nav__link">
      Bootstrap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multiplealleles/" title="Multiple Alleles" class="md-nav__link">
      Multiple Alleles
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Trait Evolution
      </label>
    
    <a href="./" title="Trait Evolution" class="md-nav__link md-nav__link--active">
      Trait Evolution
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simulation" title="Simulation" class="md-nav__link">
    Simulation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phylogenetic-regression" title="Phylogenetic Regression" class="md-nav__link">
    Phylogenetic Regression
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ancestral-state-reconstruction" title="Ancestral State Reconstruction" class="md-nav__link">
    Ancestral State Reconstruction
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-known-parameters" title="From known parameters" class="md-nav__link">
    From known parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-estimated-parameters" title="From estimated parameters" class="md-nav__link">
    From estimated parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-known-predictors" title="With known predictors" class="md-nav__link">
    With known predictors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-imputation" title="Data Imputation" class="md-nav__link">
    Data Imputation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phylogenetic-anova" title="Phylogenetic ANOVA" class="md-nav__link">
    Phylogenetic ANOVA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pagels-lambda" title="Pagel's Lambda" class="md-nav__link">
    Pagel's Lambda
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Library
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Library
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lib/public/" title="Public" class="md-nav__link">
      Public
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lib/internals/" title="Internals" class="md-nav__link">
      Internals
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simulation" title="Simulation" class="md-nav__link">
    Simulation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phylogenetic-regression" title="Phylogenetic Regression" class="md-nav__link">
    Phylogenetic Regression
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ancestral-state-reconstruction" title="Ancestral State Reconstruction" class="md-nav__link">
    Ancestral State Reconstruction
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-known-parameters" title="From known parameters" class="md-nav__link">
    From known parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-estimated-parameters" title="From estimated parameters" class="md-nav__link">
    From estimated parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-known-predictors" title="With known predictors" class="md-nav__link">
    With known predictors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-imputation" title="Data Imputation" class="md-nav__link">
    Data Imputation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phylogenetic-anova" title="Phylogenetic ANOVA" class="md-nav__link">
    Phylogenetic ANOVA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pagels-lambda" title="Pagel's Lambda" class="md-nav__link">
    Pagel's Lambda
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/crsl4/PhyloNetworks.jl/edit/master/docs/man/trait_tree.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                
                
                <p><a id='Trait-Evolution-1'></a></p>
<h1 id="trait-evolution">Trait Evolution</h1>
<p>Once the network is inferred, we can use it for downstream analysis, including for Phylogenetic Comparative Methods (PCM).</p>
<p>The following examples show how to use functions to analyze trait evolution, in the special case when the evolutionary network is in fact a phylogenetic tree. This tree is assumed to be rooted, fixed, and with branch lengths.</p>
<p>The examples below use a dataset described in Mahler et al. (2013)<sup id="fnref:fn1"><a class="footnote-ref" href="#fn:fn1" rel="footnote">1</a></sup>, available on Dryad <sup id="fnref:fn2"><a class="footnote-ref" href="#fn:fn2" rel="footnote">2</a></sup>. We can read it in from file <code>examples/lizard_tree.txt</code> <a href="https://github.com/crsl4/PhyloNetworks.jl/blob/master/examples/lizard_tree.txt">(here)</a> in Newick format:</p>
<pre><code class="julia">phy = readTopology(joinpath(Pkg.dir(&quot;PhyloNetworks&quot;), &quot;examples&quot;, &quot;lizard_tree.txt&quot;));
</code></pre>

<p><a id='Simulation-1'></a></p>
<h2 id="simulation">Simulation</h2>
<p>Tools are available to simulate trait data on a given phylogenetic tree. For now, only simulations according to a simple Brownian Motion (BM) are implemented.</p>
<p>We first need to create an object of class <a href="../../lib/public/#PhyloNetworks.ParamsBM"><code>ParamsBM</code></a><code>&lt;:ParamsProcess</code>:</p>
<pre><code class="julia">params_simu = ParamsBM(2, 0.5) # BM with mean 2 and variance 0.5
</code></pre>

<p>We can then simulate according to these parameters on the phylogeny, using function <a href="../../lib/public/#PhyloNetworks.simulate"><code>simulate</code></a>.</p>
<pre><code class="julia">sim = simulate(phy, params_simu) # simulate a BM on phy
</code></pre>

<p>This creates an object of class <a href="../../lib/public/#PhyloNetworks.TraitSimulation"><code>TraitSimulation</code></a>, from which we can extract the data at the tips, thanks to the method <a href="../../lib/public/#Base.getindex-Tuple{PhyloNetworks.TraitSimulation,Symbol}"><code>getindex(::TraitSimulation, ::Symbol)</code></a>:</p>
<pre><code class="julia">pred = sim[:Tips]
</code></pre>

<p>We can also extract the simulated values at the internal nodes of the phylogeny:</p>
<pre><code class="julia">predNodes = sim[:InternalNodes]
</code></pre>

<p>Both extractors create an <code>Array</code> with one column, and as many lines as the number of tips (respectively, internal nodes) there are in the phylogeny.  It is sorted in the same order as the tips (respectively, internal nodes) of the phylogeny used to simulate it.</p>
<p><a id='Phylogenetic-Regression-1'></a></p>
<h2 id="phylogenetic-regression">Phylogenetic Regression</h2>
<p>The main function that can be used to do phylogenetic regression is the function <a href="../../lib/public/#PhyloNetworks.phyloNetworklm"><code>phyloNetworklm</code></a>. It is based on function <code>lm</code> from package <a href="https://github.com/JuliaStats/GLM.jl">GLM</a>, and inherits from a lot of its features.</p>
<p>In this example, we simulate data for later analysis. We use the predictor simulated above to create a new trait that depends linearly on the predictor, with a noise that has a phylogenetic structure:</p>
<pre><code class="julia">noise = simulate(phy, ParamsBM(0, 0.1)) # Phylogenetic residuals
trait = 10 + 2 * pred + noise[:Tips] # Trait to study
</code></pre>

<p>Below, we create a data frame that contains the trait, the predictor, and the tip names.  In order to avoid confusion, it is important that the data frame contains an extra column specifying the tip names, labeled <code>tipNames</code>.</p>
<pre><code class="julia">using DataFrames
dat = DataFrame(trait = trait, pred = pred, tipNames = tipLabels(sim))
</code></pre>

<p>Phylogenetic regression / ANOVA can then be done like with the <a href="https://github.com/JuliaStats/GLM.jl">GLM</a> package, using formulas. We just need to specify the phylogeny we are using:</p>
<pre><code class="julia">fitTrait = phyloNetworklm(trait ~ pred, dat, phy)
</code></pre>

<p>This returns an object of type <a href="../../lib/public/#PhyloNetworks.PhyloNetworkLinearModel"><code>PhyloNetworkLinearModel</code></a><code>&lt;:LinPredModel</code>. It is dominated by the GLM type <code>LinPredModel</code>, which means that all base functions from Julia <a href="https://github.com/JuliaStats/StatsBase.jl">StatsBase</a> can be applied to it. See the documentation for this type for a list of all functions that can be used. Some functions allow the user to retrieve directly the estimated parameters of the BM, and are specific to this object.</p>
<pre><code class="julia">@doc PhyloNetworkLinearModel # list all base functions
sigma2_estim(fitTrait) # estimated variance of the BM
mu_estim(fitTrait) # estimated root value of the BM
</code></pre>

<p><a id='Ancestral-State-Reconstruction-1'></a></p>
<h2 id="ancestral-state-reconstruction">Ancestral State Reconstruction</h2>
<p>When we know the model of evolution that the traits followed, we can do ancestral state reconstruction, finding the Best Linear Unbiased Predictor (BLUP) and their prediction intervals, for the trait values at internal nodes.</p>
<p><a id='From-known-parameters-1'></a></p>
<h3 id="from-known-parameters">From known parameters</h3>
<p>Here, we simulated the predictor trait ourselves, so we know the exact model of evolution that generated the data. In this favorable case, an ancestral state reconstruction can be obtained using function <a href="../../lib/public/#PhyloNetworks.ancestralStateReconstruction"><code>ancestralStateReconstruction</code></a>:</p>
<pre><code class="julia">ancPred = ancestralStateReconstruction(phy, pred, params_simu)
</code></pre>

<p>The object created has type <a href="../../lib/public/#PhyloNetworks.ReconstructedStates"><code>ReconstructedStates</code></a>. Several extractors can be applied to it:</p>
<pre><code class="julia">expectations(ancPred) # The predictors
stderr(ancPred) # The standard errors associated
predint(ancPred) # The prediction interval (default to 95%)
</code></pre>

<p>The <code>PhyloNetworks</code> plot function can be used to plot the ancestral states or prediction intervals on the tree, using the <code>nodeLabel</code> argument, and the <a href="../../lib/public/#PhyloNetworks.expectationsPlot"><code>expectationsPlot</code></a> or <a href="../../lib/public/#PhyloNetworks.predintPlot"><code>predintPlot</code></a> utility function:</p>
<pre><code class="julia">ancExpe = expectationsPlot(ancPred) # Format the expected ancestral states for the plot
plot(phy, nodeLabel = ancExpe)
</code></pre>

<p><img alt="Ancestral State Reconstruction." src="../../assets/figures/trait_tree_ancestral_expe_1.png" /></p>
<pre><code class="julia">ancInt = predintPlot(ancPred) # Format the prediction intervals for the plot
plot(phy, nodeLabel = ancInt)
</code></pre>

<p><img alt="Prediction Intervals." src="../../assets/figures/trait_tree_ancestral_predint_1.png" /></p>
<p>As we know the true ancestral states here, we can compare them to our estimation. In particular, we can count the number of times the true value lies in the prediction interval. This should be true about 95% of the times.</p>
<pre><code class="julia">julia&gt; sum((predNodes .&lt; predint(ancPred)[1:99, 2]) &amp; (predNodes .&gt; predint(ancPred)[1:99, 1]))
93

</code></pre>

<p><a id='From-estimated-parameters-1'></a></p>
<h3 id="from-estimated-parameters">From estimated parameters</h3>
<p>In real applications though, we do not have access to the true parameters of the process that generated the data. If we make an assumption on process (like a BM for the residuals here), we can estimate it using the previous function. To fit a regular BM, we just need to do a regression of the trait against a simple intercept:</p>
<pre><code class="julia">
fitPred = phyloNetworklm(pred ~ 1, dat, phy)
</code></pre>

<p>We can then apply the <a href="../../lib/public/#PhyloNetworks.ancestralStateReconstruction"><code>ancestralStateReconstruction</code></a> function directly to the fitted object:</p>
<pre><code class="julia">
ancPredApprox = ancestralStateReconstruction(fitPred)
</code></pre>

<p>The prediction intervals ignore the fact that we estimated the process parameters, so they are less accurate and the function throws a warning. The output is an object of the same <a href="../../lib/public/#PhyloNetworks.ReconstructedStates"><code>ReconstructedStates</code></a> type as earlier, and the same extractors can be applied to it:</p>
<pre><code class="julia">
plot(phy, nodeLabel = expectationsPlot(ancPredApprox))
</code></pre>

<p>For convenience, the two steps described above (fitting against the intercept, and then do ancestral state reconstruction) can be done all at once with a single call of the function <a href="../../lib/public/#PhyloNetworks.ancestralStateReconstruction"><code>ancestralStateReconstruction</code></a> on a DataFrame with the trait to reconstruct, and the tip labels:</p>
<pre><code class="julia">
datPred = DataFrame(pred = pred, tipNames = tipLabels(sim))
ancPredApprox = ancestralStateReconstruction(datPred, phy)
plot(phy, nodeLabel = predintPlot(ancPredApprox))
</code></pre>

<p>This produces the exact same results.</p>
<p><a id='With-known-predictors-1'></a></p>
<h3 id="with-known-predictors">With known predictors</h3>
<p>At this point, it might be tempting to apply this function to the trait we simulated earlier as a linear combination of the predictor and a phylogenetic noise.  However, this cannot be done directly:</p>
<pre><code class="julia">
ancTrait = ancestralStateReconstruction(fitTrait) # Throws an error !
</code></pre>

<p>This is because the model we used to fit the trait (a regression with one predictor and an intercept) is not compatible with the simple model of Brownian evolution that we assumed for the ancestral state reconstruction. As the predictor used is not known for ancestral states, it is not possible to reconstruct the trait for this particular model.</p>
<p>The only option we have is to provide the function with the predictor's ancestral states, if they are known. They are known indeed in this toy example that we generated ourselves, so we can reconstruct our trait doing the following:</p>
<pre><code class="julia">
ancTrait = ancestralStateReconstruction(fitTrait, [ones(99, 1) predNodes])
plot(phy, nodeLabel = predintPlot(ancTrait))
</code></pre>

<p>where we provided the ancestral predictors as a matrix, containing the intercept, and the known predictor at the nodes. The user must be very careful with this function, as no check is done for the order of the predictors, that must be in the same order as the internal nodes of the phylogeny. As ancestral predictors are often unknown, the use of this functionality is discouraged.</p>
<p><a id='Data-Imputation-1'></a></p>
<h2 id="data-imputation">Data Imputation</h2>
<p>There is no theoretical difference between an internal node, for which we could not measure the value of the trait, and a missing value at a tip of the phylogeny. Consequently, the previous <a href="../../lib/public/#PhyloNetworks.ancestralStateReconstruction"><code>ancestralStateReconstruction</code></a> function can be used to do data imputation. To see this, let's add some missing values in the <code>pred</code> array we used earlier:</p>
<pre><code class="julia">
datPred[[2, 6, 15, 38, 54, 89], :pred] = NA;
ancPredApprox = ancestralStateReconstruction(datPred, phy)
plot(phy, nodeLabel = predintPlot(ancPredApprox))
</code></pre>

<p>In the plotting function, a prediction interval is shown for the missing values.</p>
<p><a id='Phylogenetic-ANOVA-1'></a></p>
<h2 id="phylogenetic-anova">Phylogenetic ANOVA</h2>
<p>As mentioned above, the <a href="../../lib/public/#PhyloNetworks.phyloNetworklm"><code>phyloNetworklm</code></a>function is based on the <code>lm</code> function from <a href="https://github.com/JuliaStats/GLM.jl">GLM</a>. This means that it inherits from most of its features, and in particular, it can handle formulas with factors or interactions. To see this, let's load a subset of the lizard dataset <sup id="fnref2:fn1"><a class="footnote-ref" href="#fn:fn1" rel="footnote">1</a></sup> we already used:</p>
<pre><code class="julia">
dat = readtable(joinpath(Pkg.dir(&quot;PhyloNetworks&quot;), &quot;examples&quot;, &quot;lizard_trait.txt&quot;));
</code></pre>

<p>This example file can be accessed <a href="https://github.com/crsl4/PhyloNetworks.jl/blob/master/examples/lizard_trait.txt">here</a>. This DataFrame has four columns: <code>tipNames</code> contains the tips names of the species, matching the one on the phylogeny we already loaded earlier; <code>AVG_SVL</code> is the average body size ("Snout to Vent Length"); <code>AVG_ltoe_IV</code> and <code>AVG_lfing_IV</code> are the average length of the fourth toe and finger; and <code>region</code> is a factor with 4 levels coding for the region where each species is found. See the description of the dataset on Dryad<sup id="fnref2:fn2"><a class="footnote-ref" href="#fn:fn2" rel="footnote">2</a></sup> for further information, and other measured traits.</p>
<p>For the sake of this example, let's assume that we want to do a regression of the SVL length against the toe and finger lengths, taking the region into account, and with an interaction between the finger length and the region. (This model has no biological basis. It is just meant to show the possibilities of the function). First, we need to make sure that the region information is indeed considered as a factor. This is done by transforming the region column into a <code>PooledDataArray</code>:</p>
<pre><code class="julia">
dat[:region] = PooledDataArray(dat[:region]); # Pool by region
</code></pre>

<p>Then, we just need to apply <a href="../../lib/public/#PhyloNetworks.phyloNetworklm"><code>phyloNetworklm</code></a> with the right formula:</p>
<pre><code class="julia">
fitAnova = phyloNetworklm(AVG_SVL ~ AVG_ltoe_IV + AVG_lfing_IV * region, dat, phy)
</code></pre>

<p>As before, a summary is shown by default, and all the functions that can be applied to a <code>lm</code> result still apply here.</p>
<p><a id='Pagel's-Lambda-1'></a></p>
<h2 id="pagels-lambda">Pagel's Lambda</h2>
<p>One classical question about trait evolution is the amount of "phylogenetic signal" in a dataset, that is, the importance of the tree structure to explain variation in the observed traits. One way of doing measuring that is to use Pagel's lambda<sup id="fnref:fn3"><a class="footnote-ref" href="#fn:fn3" rel="footnote">3</a></sup> transformation of the branch lengths. This model assumes a BM on a tree where the internal branches are multiplied by a factor $\lambda$, while the external branches are modified so that the total height of the tree is constant. Hence, $\lambda$ varies between $0$ (the tree has no influence on the data) and $1$ (the tree is unchanged).</p>
<p>We can illustrate this with the predictor trait we used earlier. We use the same function as before, only indicating the model we want to use:</p>
<pre><code class="julia">
fitPagel = phyloNetworklm(pred ~ 1, datPred, phy, model = &quot;lambda&quot;)
</code></pre>

<p>As it is indeed generated according to a plain BM on the phylogeny, the estimated $\lambda$ should be close to $1$. It can be extracted with function <code>lambda_estim</code>:</p>
<pre><code class="julia">
lambda_estim(fitPagel)
</code></pre>

<p>Note that we took a version of the dataset with missing values, that can be readily handed by the function <a href="../../lib/public/#PhyloNetworks.phyloNetworklm"><code>phyloNetworklm</code></a>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:fn1">
<p>Mahler DL, Ingram T, Revell LJ, Losos JB (2013). Exceptional     convergence on the macroevolutionary landscape in island lizard radiations.     Science 341(6143): 292-295. http://dx.doi.org/10.1126/science.1232392&#160;<a class="footnote-backref" href="#fnref:fn1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:fn1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:fn2">
<p>Mahler DL, Ingram T, Revell LJ, Losos JB (2013). Data from: Exceptional     convergence on the macroevolutionary landscape in island lizard radiations.     Dryad Digital Repository. http://dx.doi.org/10.5061/dryad.9g182&#160;<a class="footnote-backref" href="#fnref:fn2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:fn2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:fn3">
<p>Pagel M (1999). Inferring the historical patterns of biological     evolution. Nature. 401: 877–884. doi:10.1038/44766&#160;<a class="footnote-backref" href="#fnref:fn3" rev="footnote" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../multiplealleles/" title="Multiple Alleles" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Multiple Alleles
              </span>
            </div>
          </a>
        
        
          <a href="../../lib/public/" title="Public" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Public
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-ad1183cb07.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../assets/mathjaxhelper.js"></script>
      
    
    
      
    
  </body>
</html>